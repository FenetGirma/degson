<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Events - Event Management System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #F4F7FE;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .sidebar {
      width: 250px;
      height: 100vh;
      background-color: white;
      display: flex;
      flex-direction: column;
      position: fixed;
      padding-top: 20px;
      align-items: center;
    }

    .sidebar a {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      text-decoration: none;
      font-size: 1rem;
      color: #939FBD;
      transition: all 0.3s ease;
    }

    .sidebar a i {
      font-size: 1.2rem;
      margin-right: 15px;
      transition: color 0.3s ease;
    }

    .sidebar a.active {
      color: black;
      background-color: #F4F7FE;
      font-weight: 600;
    }

    .sidebar a.active i {
      color: #48BB78;
    }

    .sidebar a:hover {
      color: black;
      background-color: #F4F7FE;
    }

    .sidebar a:hover i {
      color: #48BB78;
    }

    .btn-custom {
      background: linear-gradient(90deg, #48BB78, #3aa366);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      padding: 12px 30px;
      border-radius: 50px;
      transition: all 0.3s ease-in-out;
      border: none;
      margin-top: 15px;
    }

    .btn-custom:hover {
      background: #3aa366;
      transform: scale(1.05);
    }

    .event-list {
      margin-top: 30px;
    }

    h1 {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      font-style: italic;
      color: #1B254B;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
    }

    .main-container {
      margin-left: 250px;
      margin-top: 100px;
      padding: 20px;
      flex-grow: 1;
    }

    .top-bar {
      position: fixed;
      top: 0;
      left: 1000px;
      right: 0;
      height: 70px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 30px;
      padding: 0 20px;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .top-bar .search-container {
      display: flex;
      align-items: center;
      background: #F4F7FE;
      padding: 10px 20px;
      border-radius: 30px;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
      flex: 1;
      max-width: 400px;
    }

    .top-bar .search-container input {
      border: none;
      outline: none;
      background: none;
      flex: 1;
      font-size: 1rem;
      color: #939FBD;
    }

    .top-bar .search-container i {
      margin-right: 10px;
      color: #939FBD;
    }

    .top-bar .icon-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .top-bar .icon-container i {
      font-size: 1.2rem;
      color: #939FBD;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .top-bar .icon-container i:hover {
      color: #0d6efd;
    }

    .top-bar .profile {
      width: 40px;
      height: 40px;
      background: #3aa366;
      border-radius: 50%;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
    }
    .header {
        display: flex;
        justify-content: space-between;
        align-content: center;

    }

    .custom-table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .custom-table thead {
        background: linear-gradient(90deg, #6FCF97, rgba(58, 163, 102, 0.3));
      color: white;
    }

    .custom-table th,
    .custom-table td {
      text-align: center;
      padding: 15px;
      border-bottom: 1px solid #ddd;
    }

    .custom-table tbody tr {
      transition: background-color 0.3s;
    }

    .custom-table tbody tr:hover {
      background: linear-gradient(90deg, rgba(72, 187, 120, 0.2), rgba(58, 163, 102, 0.2));
    }

    .custom-table tbody tr:last-child td {
      border-bottom: none;
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <div>
      <a href="#" class="text-decoration-none d-flex align-items-center">
        <img src="wmremove-transformed.png" alt="Logo" class="rounded-circle me-2" style="width: 110px; height: 95px;">
      </a>
    </div>
    <div>
      <a href="#dashboard" class="active"><i class="bi bi-house-door"></i>Dashboard</a>
      <a href="#events"><i class="bi bi-calendar-event"></i>Events</a>
      <a href="#create-event"><i class="bi bi-plus-circle"></i>Create Event</a>
      <a href="#settings"><i class="bi bi-gear"></i>Settings</a>
      <a href="#logout"><i class="bi bi-box-arrow-right"></i>Logout</a>
    </div>
    <div class="glass-image">
        <img src="/Events-amico%20(1).png" alt="Event Management" style="width: 200px;height:180px;padding-top: 90px">

    </div>
  </div>

  <div class="top-bar">
    <div class="search-container">
      <i class="bi bi-search"></i>
      <input type="text" placeholder="Search...">
    </div>
    <div class="icon-container">
      <i class="bi bi-bell"></i>
      <i class="bi bi-moon"></i>
      <div class="profile">AP</div>
    </div>
  </div>

  <div class="main-container">
    <div class="header">
      <h1>Event Management</h1>
      <button class="btn btn-custom" data-bs-toggle="modal" data-bs-target="#createEventModal">Create Event</button>
    </div>

    <div class="event-list">
      <table class="custom-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Event Name</th>
            <th>Category</th>
            <th>Location</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>Networking Night</td>
            <td>Networking</td>
            <td>Downtown Conference Center</td>
            <td>2025-02-14</td>
            <td>
              <button class="btn btn-outline-primary btn-sm"><i class="bi bi-pencil"></i> Edit</button>
              <button class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i> Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="modal fade" id="createEventModal" tabindex="-1" aria-labelledby="createEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createEventModalLabel">Create New Event</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="eventName" class="form-label">Event Name</label>
              <input type="text" class="form-control" id="eventName" placeholder="Enter event name">
            </div>
            <div class="mb-3">
              <label for="eventCategory" class="form-label">Category</label>
              <input type="text" class="form-control" id="eventCategory" placeholder="Enter event category">
            </div>
            <div class="mb-3">
              <label for="eventLocation" class="form-label">Location</label>
              <input type="text" class="form-control" id="eventLocation" placeholder="Enter event location">
            </div>
            <div class="mb-3">
              <label for="eventDate" class="form-label">Date</label>
              <input type="date" class="form-control" id="eventDate">
            </div>
            <div class="mb-3">
                <label for="eventTime" class="form-label">Event Time</label>
                <input type="time" class="form-control" id="eventTime" required>
              </div>
            <div class="mb-3">
              <label for="eventDescription" class="form-label">Description</label>
              <textarea class="form-control" id="eventDescription" rows="3" placeholder="Enter event description"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="saveEvent()">Save Event</button>


        </div>
      </div>
    </div>
  </div>
  

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Select the sidebar links and the main heading
    const sidebarLinks = document.querySelectorAll('.sidebar a');
    const mainHeading = document.querySelector('h1');
  
    // Add event listeners to each sidebar link
    sidebarLinks.forEach(link => {
      link.addEventListener('click', event => {
        event.preventDefault(); // Prevent default anchor behavior
  
        // Update the active class
        sidebarLinks.forEach(link => link.classList.remove('active'));
        link.classList.add('active');
  
        // Update the main heading text based on the link text
        mainHeading.textContent = link.textContent.trim();
      });
    });

  </script>
  <script>
    const apiUrl = "http://localhost:8080/api/events"; // Change based on your backend URL
  
    // Fetch events and populate table
    async function loadEvents() {
        const response = await fetch(apiUrl);
        const events = await response.json();
        const tbody = document.querySelector(".custom-table tbody");
        tbody.innerHTML = ""; // Clear existing rows
  
        events.forEach((event, index) => {
            const row = `
                <tr>
                    <td>${index + 1}</td>
                    <td>${event.name}</td>
                    <td>${event.category}</td>
                    <td>${event.location}</td>
                    <td>${new Date(event.date).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-outline-info btn-sm" onclick="viewEvent(${event.id})"><i class="bi bi-eye"></i> View</button>
                        <button class="btn btn-outline-primary btn-sm" onclick="editEvent(${event.id})"><i class="bi bi-pencil"></i> Edit</button>
                        <button class="btn btn-outline-danger btn-sm" onclick="deleteEvent(${event.id})"><i class="bi bi-trash"></i> Delete</button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }
  
    // Call loadEvents on page load
    document.addEventListener("DOMContentLoaded", loadEvents);
  </script>
  
  <script>
    async function saveEvent() {
        const event = {
            name: document.getElementById("eventName").value,
            category: document.getElementById("eventCategory").value,
            location: document.getElementById("eventLocation").value,
            date: document.getElementById("eventDate").value,
            description: document.getElementById("eventDescription").value
        };
  
        const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(event)
        });
  
        if (response.ok) {
            alert("Event Created Successfully!");
            document.getElementById("createEventModal").querySelector(".btn-close").click();
            loadEvents(); // Refresh event list
        } else {
            alert("Error creating event!");
        }
    }
  </script>
<script>
    async function deleteEvent(id) {
        if (confirm("Are you sure you want to delete this event?")) {
            const response = await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
  
            if (response.ok) {
                alert("Event Deleted Successfully!");
                loadEvents(); // Refresh event list
            } else {
                alert("Error deleting event!");
            }
        }
    }

  </script>
  <script>
    // Function to decode JWT token
function decodeToken(token) {
    try {
        const payloadBase64 = token.split(".")[1];
        const payloadJson = atob(payloadBase64); // Decode Base64 payload
        return JSON.parse(payloadJson);
    } catch (error) {
        console.error("Invalid token format", error);
        return null;
    }
}

// Function to extract initials from email
function getInitialsFromEmail(email) {
    if (!email) return "NA"; // Default if email is missing
    const parts = email.split("@")[0].split(/[._]/); // Split by dot or underscore
    const initials = parts.map(part => part.charAt(0).toUpperCase()).join("");
    return initials.slice(0, 2); // Take first two initials
}

// Save initials to localStorage
function saveInitialsFromToken(token) {
    const decodedToken = decodeToken(token);
    if (decodedToken && (decodedToken.email || decodedToken.sub)) {
        const email = decodedToken.email || decodedToken.sub; // Fallback to 'sub' if 'email' is not present
        const initials = getInitialsFromEmail(email);
        localStorage.setItem("userInitials", initials);
    } else {
        console.error("Token does not contain an email or subject.");
    }
}


// Display initials in the profile circle
function displayInitials() {
    const initials = localStorage.getItem("userInitials") || "NA";
    const profileCircle = document.querySelector(".profile");
    profileCircle.textContent = initials;
}

// Example: Load token from local storage and process it
document.addEventListener("DOMContentLoaded", () => {
    const token = localStorage.getItem("authToken"); // Replace 'authToken' with your token key
    if (token) {
        saveInitialsFromToken(token);
    }
    displayInitials();
});

  </script>
    
  
</body>

</html>

